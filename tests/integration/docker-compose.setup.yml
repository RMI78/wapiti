services:
  # Apache server for the backup module
  backup:
    image: ${PHP_HASH}
    volumes:
      - ./backup/html/:/var/www/html/
    networks:
      - test-network

  # Wordpress database and wordpress container 
  # for the wp_enum
  wp_db:
    image: ${MYSQL_HASH}
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: "somewordpress"
      MYSQL_DATABASE: "wordpress"
      MYSQL_USER: "wordpress"
      MYSQL_PASSWORD: "wordpress"
    networks:
      - test-network

  wordpress:
    build:
      context: ./wp_enum/
      dockerfile: Dockerfile
      no_cache: true
    depends_on:
      - wp_db
    restart: always
    environment:
      WORDPRESS_DB_HOST: "wp_db"
      WORDPRESS_DB_USER: "wordpress"
      WORDPRESS_DB_PASSWORD: "wordpress"
      WORDPRESS_DB_NAME: "wordpress"
    networks:
      - test-network

  # Apache container for the brute_login_form module
  brute_login_form:
    image: ${PHP_HASH}
    volumes:
      - ./brute_login_form/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the buster module
  buster:
    image: ${PHP_HASH}
    volumes:
      - ./buster/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the cookieflags module
  cookieflags:
    image: ${PHP_HASH}
    volumes:
      - ./cookieflags/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the crlf module
  crlf:
    image: ${PHP_HASH}
    volumes:
      - ./crlf/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the csp module
  csp:
    image: ${PHP_HASH}
    volumes:
      - ./csp/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the exec module
  exec:
    image: ${PHP_HASH}
    volumes:
      - ./exec/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the file module
  file:
    image: ${PHP_HASH}
    volumes:
      - ./file/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the htaccess module
  htaccess:
    build:
      context: ./htaccess/
      dockerfile: Dockerfile
    volumes:
      - ./htaccess/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the htp module
  htp:
    image: ${PHP_HASH}
    volumes:
      - ./htp/php/src:/var/www/html/
    networks:
      - test-network

  # Drupal containers and their databases for the drupal_enum module
  drupal9:
    image: ${DRUPAL9_HASH}
    networks:
      - test-network
    environment:
      MYSQL_HOST: drupal9-db
      MYSQL_DATABASE: ${DRUPAL_MYSQL_DB}
      MYSQL_USER: ${DRUPAL_MYSQL_USER}
      MYSQL_PASSWORD: ${DRUPAL_MYSQL_PASSWORD}
    depends_on:
      - drupal9-db

  drupal9-db:
    image: ${MYSQL_HASH}
    environment:
      MYSQL_DATABASE: ${DRUPAL_MYSQL_DB}
      MYSQL_USER: ${DRUPAL_MYSQL_USER}
      MYSQL_PASSWORD: ${DRUPAL_MYSQL_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${DRUPAL_MYSQL_ROOT_PASSWORD}
    networks:
      - test-network

  drupal10:
    image: ${DRUPAL10_HASH}
    networks:
      - test-network
    environment:
      MYSQL_HOST: drupal10-db
      MYSQL_DATABASE: ${DRUPAL_MYSQL_DB}
      MYSQL_USER: ${DRUPAL_MYSQL_USER}
      MYSQL_PASSWORD: ${DRUPAL_MYSQL_PASSWORD}
    depends_on:
      - drupal10-db

  drupal10-db:
    image: ${MYSQL_HASH}
    environment:
      MYSQL_DATABASE: ${DRUPAL_MYSQL_DB}
      MYSQL_USER: ${DRUPAL_MYSQL_USER}
      MYSQL_PASSWORD: ${DRUPAL_MYSQL_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${DRUPAL_MYSQL_ROOT_PASSWORD}
    networks:
      - test-network

  # Apache container for the http_headers module
  http_headers:
    build:
      context: ./http_headers/
      dockerfile: "Dockerfile"
    volumes:
      - ./http_headers/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the log4shell module
  log4shell:
    image: ${PHP_HASH}
    volumes:
      - ./log4shell/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the methods module
  methods:
    image: ${PHP_HASH}
    volumes:
      - ./methods/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the nikto module
  nikto:
    image: ${PHP_HASH}
    volumes:
      - ./nikto/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the permanentxss module
  permanentxss:
    image: ${PHP_HASH}
    volumes:
      - ./permanentxss/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the xxe module
  xxe:
    image: ${PHP_HASH}
    volumes:
      - ./xxe/php/src/:/var/www/html/
    networks:
      - test-network

  # Apache container for the shellshock module
  shellshock:
    image: ${PHP_HASH}
    volumes:
      - ./shellshock/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the sql module
  sql:
    image: ${PHP_HASH}
    volumes:
      - ./sql/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the ssl module
  ssl:
    image: ${PHP_HASH}
    volumes:
      - ./ssl/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the ssrf module
  ssrf:
    image: ${PHP_HASH}
    volumes:
      - ./ssrf/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the takeover module
  takeover:
    image: ${PHP_HASH}
    volumes:
      - ./takeover/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the timesql module
  timesql:
    image: ${PHP_HASH}
    volumes:
      - ./timesql/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the wapp module
  wapp:
    image: ${PHP_HASH}
    volumes:
      - ./wapp/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the xss module
  xss:
    image: ${PHP_HASH}
    volumes:
      - ./xss/php/src:/var/www/html/
    networks:
      - test-network

  # Apache container for the csrf module
  csrf:
    image: ${PHP_HASH}
    volumes:
      - ./csrf/php/src:/var/www/html/
    networks:
      - test-network

  # Wapiti container
  wapiti:
    build:
      context: "../../"
      dockerfile: "Dockerfile.integration"
      no_cache: true
    container_name: wapiti
    volumes:
      - ./.test:/home/
    networks:
      - test-network
    depends_on:
      - backup
      - wp_db
      - wordpress
      - brute_login_form
      - buster
      - cookieflags
      - crlf
      - csp
      - exec
      - file
      - htaccess
      - htp
      - drupal9
      - drupal9-db
      - drupal10
      - drupal10-db
      - http_headers
      - log4shell
      - methods
      - nikto
      - permanentxss
      - xxe
      - shellshock
      - sql
      - ssl
      - ssrf
      - takeover
      - timesql
      - wapp
      - xss

volumes:
  db_data:
networks:
  test-network:
